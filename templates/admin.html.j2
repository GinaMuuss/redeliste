{% extends "layout.html.j2" %}
{% block head %}
    <script type="text/javascript" charset="utf-8">
        document.addEventListener("DOMContentLoaded", function(){

            // Connect to the Socket.IO server.
            namespace = '/{{ room.admin_room.key }}';
            var socket = io(namespace);

            socket.on('data_update', function(data, cb) {
                console.log(data);
                for(var x in data){
                    var channel = data[x];
                    var sel = "#channel_" + channel.channel_id + " div.list-container" 
                    var ele = document.querySelector(sel)
                    var html  = "<ol>";
                    for(var y in data[x]["current_list"]){
                        var user = data[x]["current_list"][y];
                        html += "<li>" + user + "</li>";
                    }
                    html += "</ol>";
                    ele.innerHTML = html;
                }
                if(cb)
                    cb();
            });
        });
    </script>
{% endblock %}
{% block body %}
    <h1>Your Room: {{ room.name }}</h1>
    <!-- TODO: layout -->
    <div id="room_details">
        <a href="/admin/{{ room.admin_room.key }}">Admin Link</a>

        <a href="/guest/{{ room.guest_key }}">Guest Link</a>
    </div>
    <div id="channel_details" class="channel-flex">
    {% for channel in room.get_channels() %}
        <div id="channel_{{channel.id}}" class="channel-flex-item"><h3>{{channel.name}}</h3><div class="list-container"></div></div>
    {%- endfor %}
    </div>
{% endblock %}
